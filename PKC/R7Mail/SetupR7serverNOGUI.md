## Установка Корпоративного сервера 2024 без графического интерфейса offline-версии(без интернета) для ОС Astra.

Установка произваодится на VM Ware Workstation, версия ОС Астра 1.7.4

Установка состоит из нескольких этапов:

1. Предварительная подготовка.
2. Установка необходимых служб и баз данных для почтового сервера 2024 offline-версии.
3. Установка почтового сервера R7.
4. Настройка почтового сервера.
5. Настройка почтовых протоколов в DNS на доменном сервере ALD PRO.
6. Настройка API/служб Dovecot и Postfix.
7. Настройка почтового клиента Органайзер на клиентском компьютере.
8. Работа в Органайзере.

### 1. Предварительная подготовка.   

Скачаваем образ `1.7.4-24.04.2023_14.23.iso`

#### Системные требования. 
- Поддерживается только 64-битная архитектура. 
- Процессор: рекомендуется от 2 ядер 
- Оперативная память: рекомендуется от 8 Гб 
- Свободное место на жестком диске: рекомендуется желательно не меньше 80 Гб 
- Операционная система из перечня поддерживаемых 
- Подключение к сети Интернет 
- Требуется сертификат типа wildcard

>[!WARNING]
>Минимальные системные требования рассчитаны при одновременной работе до 300 пользователей.

Устанавливаем виртуальную машину ОС Астра 1.7.4 из образа `1.7.4-24.04.2023_14.23.iso`<br>
При установке операционной системы выберите пункты <br>
**«Средства работы с интернет»** <br>
**«Консольные утилиты»** <br>
**«Средства удаленного подключения SSH»** <br>
во избежание сообщений об отсутствующих зависимостях <br>

Для упрощения в работе временно даём разрешение на подключению по ssh для суперадмина root

Открываем терминал меняем пароль на root и даём разрешение на подключение в файле `/etc/ssh/sshd_config`

![image](https://github.com/user-attachments/assets/f97a31ec-cc05-444a-9bbf-9670397f860e)

После установки выполняем команды:

Открываем репозитории `` nano /etc/apt/sources.list`` и комментируем все репозитории

Для корректной установки, архив поместить в директории `/mnt`
```bash
cd /mnt
```
Скачайте архив Корпоративный сервер 2024 для установки и перетащите его в директорию /mnt  

- Оффлайн установкаТекущая версия: 2.0.2024.14752
- Модуль Р7 Диск, Модуль Р7-Админ,
- Модуль Р7-Календарь, Модуль Р7-Почта, Модуль Р7-Проекты

![image](https://github.com/user-attachments/assets/5a70f184-9664-4d04-b2b3-9983295d8222)

Скачать пакеты можно по ссылке: [https://r7-office.ru/downloadserver#retail]

![image](https://github.com/user-attachments/assets/46376d55-c05c-464a-8b1a-53e62ee45c6e)

![image](https://github.com/user-attachments/assets/495b298b-52d6-437e-b584-4ac6d80fbcec)

![image](https://github.com/user-attachments/assets/3a9287b7-68d2-4bbe-a8a3-9136fa1fddd5)

Скачайте архив `cddisk.zip` который содержит пакеты для корпоративного сервера 2024. 

Скачать пакеты можно по ссылке: [https://nct.r7-office.ru/link/549705e3-5e21-49f1-afc4-57c88ecae674]

![image](https://github.com/user-attachments/assets/df7ca167-4541-432a-b97f-8f7a8e98d9ff)

Перетащите его в директорию /mnt  

Зайдите на терминале в директорию со скаченными архивами и распакуте их в корень папки `/mnt`

Распакуйте архив `CDinstall_2.0.2024.14752_Astra_1.7.4_offline.zip`
```bash
cd /mnt
unzip CDinstall_2.0.2024.14752_Astra_1.7.4_offline.zip
unzip cddisk.zip
```
![image](https://github.com/user-attachments/assets/d8f008ef-6e3e-4171-9c89-b628d56b03ad)

![image](https://github.com/user-attachments/assets/4db0bdde-9d56-47c1-a66d-b6a46219d129)

![image](https://github.com/user-attachments/assets/d0403d17-7481-4793-afb7-282de1c4643e)

После как распаковали получились две папки `CDDiskPack` и `cddisk`

Перейдите в каталог `cddisk` и установите пакеты командой `install.sh`
```
cd cddisk
chmod +x install.sh
./install.sh
```
![image](https://github.com/user-attachments/assets/6f188292-8344-4c91-8724-a3a2ea93e269)

![image](https://github.com/user-attachments/assets/01c8ed7c-29e1-46a8-80a4-2cb419f00b44)

Проверяем что распаковалось всё без ошибок и продолжаем установку.

Теперь установим шрифты от Майкрософта


>[!WARNING]
>Для offline установки требуется установить пакеты в систему и подключить iso образ установочного диска операционный системы в папку distr.

```bash

```
>[!WARNING]
>Для корректной работы Корпоративного сервера обязательно требуется настройка HTTPS. Перед установкой, скопируйте crt и key файлы в папку `/mnt/CDDiskPack/CDinstall_Astra_1.7.4/sslcert`. 

Потребуется использовать ssl сертификат типа wildcard с соответствующей А записью (пример, *.yourdomain.ru) на используемом DNS сервере в сети сервера. 

Имя файла должно содержать название домена и расширение. Рекомендуем в .crt указывать всю цепочку сертификатов, домен, промежуточные и корневой. Например, для домена r7.ru имена файлов должны быть r7.ru.crt и r7.ru.key.



















