### –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SRV-–∑–∞–ø–∏—Å–∏ IMAP –≤ DNS

–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SRV-–∑–∞–ø–∏—Å–∏ IMAP –≤ DNS –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å, —É–∫–∞–∑—ã–≤–∞—é—â—É—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π IMAP-—Å–µ—Ä–≤–∏—Å —á–µ—Ä–µ–∑ TCP. –í–æ—Ç –∫–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –ø—Ä–∏–º–µ—Ä—ã:

#### –§–æ—Ä–º–∞—Ç SRV-–∑–∞–ø–∏—Å–∏:

- **Service**: `_imap` (–æ–±—ã—á–Ω—ã–π IMAP) –∏–ª–∏ `_imaps` (IMAP —á–µ—Ä–µ–∑ SSL/TLS)  
- **tcp**: `_tcp`  
- **Name**: –î–æ–º–µ–Ω–Ω–æ–µ –∏–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `example.com`)  
- **Priority**: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∏–∂–µ = –≤—ã—à–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)  
- **Weight**: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ (–µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º)  
- **Port**: –ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞  
- **Target**: FQDN —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `mail.example.com`)  

---

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø–∏—Å–µ–π:
1. **IMAP (–ø–æ—Ä—Ç 143)**:  
   ```dns
   _imap._tcp.example.com. 3600 IN SRV 10 5 143 mail.example.com.
   ```
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: `20`, –í–µ—Å: `5`, –ü–æ—Ä—Ç: `143`.

2. **IMAPS (–ø–æ—Ä—Ç 993)**:  
   ```dns
   _imaps._tcp.example.com. 3600 IN SRV 10 5 993 mail.example.com.
   ```
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞—â–∏—â—ë–Ω–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (SSL/TLS).

---

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `dig`:
```bash
dig +short SRV _imap._tcp.example.com
```
–í—ã–≤–æ–¥ –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—É—é –∑–∞–ø–∏—Å—å.

---

#### –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:
1. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤**:  
   SRV-–∑–∞–ø–∏—Å–∏ –¥–ª—è IMAP –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –Ω–µ –≤—Å–µ–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Thunderbird –∏ Outlook –∏—Å–ø–æ–ª—å–∑—É—é—Ç MX-–∑–∞–ø–∏—Å–∏). –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à –∫–ª–∏–µ–Ω—Ç/—Å–µ—Ä–≤–µ—Ä —Ç—Ä–µ–±—É–µ—Ç SRV (–Ω–∞–ø—Ä–∏–º–µ—Ä, Autodiscover –¥–ª—è Exchange).
2. **–ü–æ—Ä—Ç—ã**:  
   - `143`: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç IMAP (–±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è).  
   - `993`: –ü–æ—Ä—Ç IMAPS (—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ SSL/TLS).  
3. **TTL**:  
   –£–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ä–æ–∫ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö). `3600` = 1 —á–∞—Å.

---

 –û—Å–Ω–æ–≤–Ω—ã–µ DNS-–∑–∞–ø–∏—Å–∏ –¥–ª—è SMTP
1. –ó–∞–ø–∏—Å—å MX (Mail Exchange)
–£–∫–∞–∑—ã–≤–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–∏–µ–º–∞ –≤—Ö–æ–¥—è—â–µ–π –ø–æ—á—Ç—ã:

text
example.com.  IN  MX  10  mail.example.com.
10 ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–º–µ–Ω—å—à–µ = –≤—ã—à–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

mail.example.com ‚Äî FQDN –≤–∞—à–µ–≥–æ SMTP-—Å–µ—Ä–≤–µ—Ä–∞

2. –ó–∞–ø–∏—Å—å A –¥–ª—è SMTP-—Å–µ—Ä–≤–µ—Ä–∞
text
mail.example.com.  IN  A  192.0.2.10
(IP-–∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)

3. –ó–∞–ø–∏—Å—å PTR (Reverse DNS)
–°–∞–º–∞—è –≤–∞–∂–Ω–∞—è –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ—á—Ç—ã! –î–æ–ª–∂–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å–∏ A:

text
10.2.0.192.in-addr.arpa.  IN  PTR  mail.example.com.
‚ö†Ô∏è –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —É —Ö–æ—Å—Ç–∏–Ω–≥-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –≤–ª–∞–¥–µ—é—â–µ–≥–æ IP-–∞–¥—Ä–µ—Å–æ–º!

üõ°Ô∏è –ó–∞–ø–∏—Å–∏ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
4. SPF (Sender Policy Framework)
–ó–∞–ø—Ä–µ—â–∞–µ—Ç –ø–æ–¥–¥–µ–ª–∫—É –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞:

text
example.com.  IN  TXT  "v=spf1 mx a:mail.example.com -all"
mx ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞–º –∏–∑ MX-–∑–∞–ø–∏—Å–µ–π

a:mail.example.com ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä

-all ‚Äî –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ –¥—Ä—É–≥–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

5. DKIM (DomainKeys Identified Mail)
–î–æ–±–∞–≤–ª—è–µ—Ç —Ü–∏—Ñ—Ä–æ–≤—É—é –ø–æ–¥–ø–∏—Å—å –∫ –ø–∏—Å—å–º–∞–º:

text
selector1._domainkey.example.com.  IN  TXT  "v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC..."
selector1 ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (—É–∑–Ω–∞–π—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö P7)

p=... ‚Äî –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º)

6. DMARC (Domain-based Message Authentication)
–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–∏—Å–µ–º, –Ω–µ –ø—Ä–æ—à–µ–¥—à–∏—Ö –ø—Ä–æ–≤–µ—Ä–∫–∏:

text
_dmarc.example.com.  IN  TXT  "v=DMARC1; p=quarantine; rua=mailto:postmaster@example.com"
p=quarantine ‚Äî –ø–æ–º–µ—â–∞—Ç—å –≤ —Å–ø–∞–º –ø—Ä–∏ –æ—à–∏–±–∫–µ

p=reject ‚Äî –æ—Ç–∫–ª–æ–Ω—è—Ç—å –ø–∏—Å—å–º–∞

rua ‚Äî email –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤

‚öôÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
7. SRV-–∑–∞–ø–∏—Å–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
text
_submission._tcp.example.com.  IN  SRV  0 5 587 mail.example.com.
_smtp._tcp.example.com.        IN  SRV  0 5 25  mail.example.com.
587 ‚Äî –ø–æ—Ä—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ—á—Ç—ã (SMTP Submission)

25 ‚Äî –ø–æ—Ä—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä-—Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –æ–±–º–µ–Ω–∞

8. –ó–∞–ø–∏—Å—å –¥–ª—è Feedback Loop
–î–ª—è –∂–∞–ª–æ–± –Ω–∞ —Å–ø–∞–º:

text
smtp.example.com.  IN  A  192.0.2.10
fbl.example.com.   IN  CNAME smtp.example.com.
üß™ –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ DNS
zonefile
; –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–ø–∏—Å–∏
example.com.        IN  A       192.0.2.10
mail.example.com.   IN  A       192.0.2.10
example.com.        IN  MX  10  mail.example.com.

; –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
example.com.        IN  TXT "v=spf1 mx a:mail.example.com -all"
selector1._domainkey IN TXT "v=DKIM1; k=rsa; p=MIGfMA0GC..."
_dmarc              IN  TXT "v=DMARC1; p=quarantine; rua=mailto:postmaster@example.com"

; –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏
_submission._tcp    IN  SRV 0 5 587 mail.example.com.
fbl                 IN  CNAME mail.example.com.
üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
–ü—Ä–æ–≤–µ—Ä–∫–∞ MX-–∑–∞–ø–∏—Å–µ–π:

bash
nslookup -type=mx example.com
–ü—Ä–æ–≤–µ—Ä–∫–∞ SPF/DKIM/DMARC:

bash
nslookup -type=txt example.com
nslookup -type=txt selector1._domainkey.example.com
nslookup -type=txt _dmarc.example.com
–ü—Ä–æ–≤–µ—Ä–∫–∞ PTR:

bash
dig -x 192.0.2.10 +short
–û–Ω–ª–∞–π–Ω-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

MXToolbox

DMARC Inspector

‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ P7-–û—Ñ–∏—Å
–í–∫–ª—é—á–∏—Ç–µ SMTP-—Å–µ—Ä–≤–∏—Å:

text
–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí –ü–æ—á—Ç–∞ ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ ‚Üí –ü—Ä–æ—Ç–æ–∫–æ–ª—ã ‚Üí SMTP
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Ä—Ç–æ–≤:

25 (SMTP) ‚Äî –¥–ª—è –ø—Ä–∏–µ–º–∞ –ø–æ—á—Ç—ã

587 (Submission) ‚Äî –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–∑ –ø–æ—á—Ç–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤

465 (SMTPS) ‚Äî —É—Å—Ç–∞—Ä–µ–≤—à–∏–π, –Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è

TLS/SSL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∏—Ç–µ STARTTLS –Ω–∞ –ø–æ—Ä—Ç—É 587

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è –¥–æ–º–µ–Ω–∞ mail.example.com

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ DKIM:

text
–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí –ê–Ω—Ç–∏—Å–ø–∞–º ‚Üí DKIM ‚Üí –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TXT-—Ä–µ–∫–æ—Ä–¥ –≤ DNS.

‚ùå –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏
–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç PTR-–∑–∞–ø–∏—Å—å ‚Üí 95% –ø–∏—Å–µ–º –≤ —Å–ø–∞–º

–û—à–∏–±–∫–∞ –≤ SPF (+all –≤–º–µ—Å—Ç–æ -all) ‚Üí —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Å–ø–∞–º–µ—Ä–∞–º –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ—Ç –≤–∞—à–µ–≥–æ –∏–º–µ–Ω–∏

–ó–∞–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä:

bash
sudo ufw allow 25/tcp
sudo ufw allow 587/tcp
–ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ HELO-–∏–º–µ–Ω–∏:

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö P7 —É–∫–∞–∂–∏—Ç–µ: helo_name = mail.example.com

–î–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å PTR –∏ A-–∑–∞–ø–∏—Å—å—é
